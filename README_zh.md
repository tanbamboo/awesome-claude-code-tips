# Claude Code 技巧和会话管理精选

中文版本 | [English Version](README.md)

Claude Code 有效使用的综合指南，涵盖会话管理、git 工作流程和 AI 辅助开发的最佳实践。

## CLAUDE.md 文件

### 目的
- 为 Claude Code 提供项目特定的指导
- 启动新会话时自动读取
- 在会话之间保持上下文

### 包含内容
- 特定的构建命令（`npm run build:prod`）- 参见 [npm 文档](https://docs.npmjs.com/cli/v7/commands/npm-run-script)
- 从文件结构不明显看出项目架构
- 自定义工作流程和约定
- 重要的依赖项和工具

### 排除内容
- 通用建议（"编写干净的代码"）
- 基本命令（`cd`, `ls`）- 参见 [Unix 命令参考](https://ss64.com/bash/)
- 通过阅读文件明显可见的信息
- 临时或实验性设置

### 保持简洁
- 使用项目符号代替段落
- 将相关信息分组到清晰的标题下
- 添加新信息时删除过时信息
- 测试："下次我在这个项目上工作时需要这个吗？"

## 会话生命周期

### 开始
- 从当前项目读取 CLAUDE.md
- 从 `~/.claude/CLAUDE.md` 加载全局设置
- 建立全新的对话上下文

### 活跃会话
- 保持对话记忆
- 可以读取、写入和修改文件
- 记住当前聊天中的先前交流
- 受[上下文窗口限制](https://docs.anthropic.com/claude/docs/context-windows)约束

### 结束
- 退出时（Ctrl+C、关闭终端、超时）
- 对话记忆被清除
- 项目文件和 CLAUDE.md 保持完整

### 会话结束后
- **保留：** 仓库文件、CLAUDE.md、package.json、配置文件
- **清除：** 对话历史、内存中的上下文
- **下次会话：** 以基于文件的上下文重新开始

## 上下文持久性

### 上下文同步方式
1. **CLAUDE.md 文件** - 主要方法，保留在仓库中
2. **仓库文件** - 源代码、package.json、配置文件
3. **全局 CLAUDE.md** - `~/.claude/CLAUDE.md` 中的个人偏好

### 更新 CLAUDE.md
- 对话中要求："update CLAUDE.md"
- 包括新命令、架构决策、项目设置
- 最佳实践：在结束会话前更新
- 专注于项目特定信息

## 最佳实践

### 开发期间
- 建立新命令时更新 CLAUDE.md
- 做出架构决策时添加
- 包括项目特定的约定

### 结束会话前
- 要求总结并保存上下文到 CLAUDE.md
- 删除过时信息
- 确保所有基本命令都已记录

### 评估标准
- **包括：** 特定命令、独特架构、自定义工作流程
- **排除：** 通用建议、基本命令、明显信息
- **测试：** 冷启动阅读这个能理解项目吗？

## CLAUDE.md 结构示例

```markdown
# CLAUDE.md

## 项目概述
项目目的和技术栈的简要描述

## 基本命令
- 构建：`npm run build`（输出到 dist/）- 参见 [npm scripts](https://docs.npmjs.com/cli/v7/using-npm/scripts)
- 测试：`npm test`（运行 Jest 并包含覆盖率）- 参见 [Jest 文档](https://jestjs.io/docs/getting-started)
- 开发：`npm run dev`（在端口 3000 启动）

## 架构说明
- 使用 [Redux Toolkit](https://redux-toolkit.js.org/introduction/getting-started) 进行状态管理
- API 层在 src/services/ 中，使用 [axios](https://axios-http.com/docs/intro) 拦截器
- 组件遵循[容器/展示器模式](https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0)

## Git 工作流程
- 实现新功能前创建功能分支 - 参见 [Git 分支](https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging)
```

## 有效使用技巧

1. **保持简短** - 10-30 行是理想的
2. **具体明确** - 包括你使用的实际命令
3. **保持最新** - 删除过时信息
4. **专注于独特性** - 这个项目有什么不同？
5. **定期更新** - 随着项目发展添加上下文

## 反直觉的技巧

### 少即是多
- **反直觉：** 较短的 CLAUDE.md 文件比全面的更有效
- **原因：** 我无论如何都会读取你的实际源代码 - CLAUDE.md 应该只指向独特/重要的部分
- **行动：** 删除明显信息。如果我能从 package.json 或 src/ 中理解，就删除它。

### 不要记录所有内容
- **反直觉：** 只记录你会忘记的或不明显的内容
- **原因：** 你未来的自己（和我）可以阅读代码。我们需要的是"为什么"和"如何"的帮助，而不是"什么"
- **行动：** 专注于决策、约定和非标准设置。

### 过时信息比没有信息更糟糕
- **反直觉：** 最小的 CLAUDE.md 比过时的更好
- **原因：** 错误信息导致错误行为。没有信息导致调查
- **行动：** 积极删除不再准确的内容。

### 我不需要你的个人偏好
- **反直觉：** 不要包括你的编码风格偏好
- **原因：** 我会自动适应你现有的代码风格
- **行动：** 删除"我更喜欢驼峰命名"或"使用 async/await 而不是 promises"

### 对话历史是临时的 - 文件是永久的
- **反直觉：** 我们的对话不如我们写入文件的内容重要
- **原因：** 下次会话重新开始，但文件保留
- **行动：** 确保重要上下文写入 CLAUDE.md 或实际代码文件。

### 不要"稍后保存"
- **反直觉：** 不要等到会话结束时才更新 CLAUDE.md
- **原因：** 你可能会忘记重要上下文或意外结束会话
- **行动：** 建立重要内容时立即更新。

### 具体性优于一般性
- **反直觉：** "运行 `npm run build:staging --verbose`" 比"构建项目"更好
- **原因：** 模糊的指导迫使我猜测或调查
- **行动：** 包括你实际使用的确切命令。

### "我需要这个吗？"测试
- **反直觉：** 对 CLAUDE.md 中的每一行问自己这个问题
- **原因：** 如果答案是"我可以通过阅读代码理解这个"，就删除它
- **行动：** 严格保持只保留真正有价值的内容。

## 会话管理

### 理想会话长度
- **短会话（15-30 分钟）：** 单个文件更改、快速问题、小型重构
- **中等会话（30 分钟 - 2 小时）：** 构建功能、多文件更改、设置任务
- **长会话（2+ 小时）：** 大规模重构、深度架构更改
- **最佳点：** 专注开发工作 1-2 小时

### 何时结束会话
- 任务自然完成
- 开始新的不相关任务
- 上下文被不相关主题弄乱
- 你已经实现了主要目标

### 单个会话的任务范围
**良好范围：**
- 构建一个完整功能（认证、API 端点、UI 组件）
- 修复一个特定错误及其根本原因
- 重构一个模块或服务
- 设置一个基础设施
- 编写一个全面的测试套件 - 参见[测试最佳实践](https://testing-library.com/docs/)

**特征：**
- 1-2 小时内可完成
- 有明确的完成标准
- 保持凝聚力（所有部分相关）
- 完成时创造价值

### 多个会话
**无同时会话** - 每个项目一次只有一个 Claude Code 会话
**你可以做什么：**
- 不同项目的多个终端
- 同一项目的顺序会话
- 不同的 Claude 实例（Web + CLI）

**最佳实践：** 每个项目一次一个会话，使用 CLAUDE.md 进行上下文持久化

## Git & GitHub 工作流程

### Git 哲学
**你控制 git 操作，我帮助质量：**
- **你处理：** 分支创建、提交、推送、合并
- **我帮助：** 提交消息、PR 描述、git 命令
- **原因：** Git 操作是你项目中的永久决策
- **了解更多：** [Pro Git Book](https://git-scm.com/book/en/v2)

### 功能分支工作流程
```bash
# 你：创建功能分支
git checkout -b feature/name

# 我：处理代码更改
# 你：审查并提交
git diff
git commit -m "feat: 描述性消息" # 参见 [Conventional Commits](https://www.conventionalcommits.org/)

# 我：起草 PR 描述
# 你：创建 PR
gh pr create --title "标题" --body "描述" # 参见 [GitHub CLI](https://cli.github.com/manual/gh_pr_create)
```

### 提交消息最佳实践
- **我写：** 遵循约定的高质量提交消息
- **你审查：** 提交前检查消息和更改
- **结果：** 更好的 git 历史，你有最终控制权

### 拉取请求过程
- **我起草：** PR 描述和清单、测试计划
- **你创建：** 使用我建议的内容创建实际 PR
- **我帮助：** 响应审查、建议改进
- **你决定：** 何时合并和集成

### GitHub 集成
**我可以帮助：**
- 起草 PR 描述和清单
- 编写 [GitHub Actions](https://docs.github.com/en/actions) 工作流程
- 创建 [问题模板](https://docs.github.com/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/creating-issue-forms)
- 分析 PR 更改的潜在问题

**你控制：**
- PR 创建和合并
- 问题创建和分配
- 团队工作流程决策
- 仓库权限

### 完整工作流程示例
参见 [example-workflow.md](example-workflow.md) 了解从分支创建到 PR 合并添加功能的完整端到端示例。

## 避免的反模式

### Git 反模式
- ❌ 在 main 分支上工作
- ❌ 包含不相关更改的巨大提交
- ❌ 提交损坏的代码"以保存它"
- ❌ 不审查我更改的内容
- ❌ 遗弃功能分支

### 会话反模式
- ❌ 会话太长（>4 小时）
- ❌ 尝试做太多不相关的任务
- ❌ 结束前不更新 CLAUDE.md
- ❌ 会话期间范围蔓延

### CLAUDE.md 反模式
- ❌ 包括个人编码偏好
- ❌ 通用建议和最佳实践
- ❌ 过时或不正确的信息
- ❌ 重复明显文件结构的文档

## 高级技巧

### 沟通策略

**具体明确**
- **不要说：** "修复这个错误"
- **要说：** "即使用户密码正确，登录表单也显示'无效凭据'。检查 src/auth.js 中的认证服务"
- **了解更多：** [如何提出好问题](https://stackoverflow.com/help/how-to-ask)

**尽早提供上下文**
- **分享：** "我正在使用 React 和 Redux，API 在 src/services/ 中，我遵循函数式组件"
- **原因：** 了解你的技术栈时我可以给出更好的答案
- **参考：** [React 文档](https://react.dev/)

**使用示例**
- **给我看：** 你希望输出看起来像什么
- **分享：** 错误消息、预期行为、当前行为

**分解复杂请求**
- **不要说：** "构建整个管理面板"
- **要说：** "首先，让我们创建带有搜索和分页的用户列表组件"

### 任务管理

**使用 TodoWrite 工具**
- **用于：** 具有多个步骤的复杂任务
- **何时：** 任何需要 3+ 个不同操作的任务
- **好处：** 我们双方的视觉进度跟踪

**从小开始，迭代**
- **首先：** 让基本功能工作
- **然后：** 添加错误处理、验证、样式
- **最后：** 优化和添加高级功能

**按价值优先**
- **专注：** 什么首先提供最大价值
- **问：** "这个功能的最小可行版本是什么？"
- **构建：** 先核心功能，再边缘情况

### 错误处理

**分享完整的错误消息**
- **复制：** 完整的错误堆栈跟踪，不仅仅是"它不工作"
- **包括：** 错误位置、行号、相关代码上下文
- **原因：** 有了完整信息我可以更快地定位问题

**系统地调试**
1. **重现：** 确认问题的一致性
2. **隔离：** 找到触发它的最小情况
3. **调查：** 检查相关代码和依赖项
4. **修复：** 解决根本原因，不仅仅是症状

**常见错误模式**
- **导入问题：** 检查文件路径和导出 - 参见 [ES 模块](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules)
- **异步问题：** 寻找缺失的 await/then - 参见 [async/await](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function)
- **状态问题：** 检查组件生命周期和状态更新
- **API 错误：** 验证端点、标头和数据格式

### 性能优化

**会话性能**
- **简洁：** 较短的提示获得更快的响应
- **批量请求：** 一次要求多个内容
- **使用上下文：** 引用之前的工作而不是重复

**代码性能**
- **具体要求：** "优化这个数据库查询" vs "让它更快"
- **首先分析：** "这个函数很慢，你能帮助优化吗？"
- **测量：** 如果可用包括性能指标

### 学习和成长

**从我的解释中学习**
- **问为什么：** "你为什么选择这种方法？"
- **要求替代方案：** "还有什么其他方法可以解决这个问题？"
- **理解权衡：** "这个解决方案的优缺点是什么？"

**建立你的知识**
- **做笔记：** 保存你学到的模式和技术
- **应用概念：** 在未来工作中使用类似方法
- **教他人：** 解释概念强化学习

### 测试策略

**测试驱动开发**
- **从测试开始：** 首先定义成功看起来像什么
- **编写失败的测试：** 确认测试捕获问题
- **实现：** 使测试通过
- **重构：** 清理实现

**要包含的测试模式**
- **快乐路径：** 预期的成功场景
- **边缘情况：** 空输入、空值、边界条件
- **错误处理：** 无效输入、网络故障
- **集成：** 组件如何协同工作
- **资源：** [测试金字塔](https://martinfowler.com/articles/practical-test-pyramid.html)

### 代码审查最佳实践

**审查我的更改**
- **始终检查：** 提交前 `git diff`
- **寻找：** 安全问题、性能问题、错误
- **提问：** 任何不理解的内容
- **建议：** 基于你的项目标准的改进

**提供良好的反馈**
- **具体：** "第 42 行有潜在的空引用" vs "这有错误"
- **解释为什么：** "这种方法可能导致内存泄漏，因为..."
- **建议解决方案：** "考虑在这里使用 useMemo"

### 项目设置技巧

**新项目清单**
- [ ] 初始化版本控制 - 参见 [Git init](https://git-scm.com/docs/git-init)
- [ ] 设置基本项目结构
- [ ] 配置构建工具
- [ ] 设置测试框架
- [ ] 使用初始设置创建 CLAUDE.md
- [ ] 设置 [CI/CD 管道](https://docs.github.com/en/actions/getting-started-with-github-actions/about-github-actions)
- [ ] 添加文档结构

**环境管理**
- **使用 .env 文件：** 用于配置和机密 - 参见 [.env 最佳实践](https://create-react-app.dev/docs/adding-custom-environment-variables/)
- **记录设置：** 包括环境设置说明
- **版本控制：** 使用 [.gitignore](https://git-scm.com/docs/gitignore) 排除敏感文件

### CLAUDE.md 之外的文档

**README.md 结构**
- 项目目的和功能
- 安装和设置说明
- 使用示例
- API 文档（如果适用）
- 贡献指南
- 许可证信息

**代码注释**
- **解释为什么：** 不仅仅是代码做什么
- **记录决策：** 为什么选择这种方法
- **标记 TODO：** 用于未来改进或已知问题
- **参考：** [代码注释最佳实践](https://www.thoughtfulcode.com/comment-your-code/)

### 协作技巧

**与团队协作**
- **沟通：** 让团队知道你正在使用 AI 协助
- **审查：** 提交前审查所有 AI 生成的代码
- **记录：** 如果团队要求，在提交消息中记录 AI 使用
- **质量：** 保持相同的代码质量标准

**知识共享**
- **分享有效的方法：** 有效的模式和工作流程
- **记录经验：** 什么有效，什么无效
- **帮助他人：** 教团队成员有效的 AI 协作

### 工具集成

**有用的组合**
- **Claude + Git：** 更好的提交消息和 PR 描述
- **Claude + 测试：** 编写全面的测试套件
- **Claude + 文档：** 生成清晰的文档
- **Claude + 代码审查：** 获得更改的第二意见
- **参考：** [AI 辅助开发最佳实践](https://www.anthropic.com/claude-code)

**自动化机会**
- **GitHub Actions：** 我可以编写 CI/CD 工作流程 - 参见 [GitHub Actions 文档](https://docs.github.com/en/actions)
- **脚本：** 自动化重复的开发任务
- **模板：** 为常见模式生成代码模板

### 思维方式和方法

**将我视为工具**
- **你负责：** 做出最终决定
- **我是助手：** 提供选项和专业知识
- **协作：** 一起工作而不是委托

**质量优于速度**
- **花时间：** 提交前审查我的工作
- **迭代：** 通过反馈改进解决方案
- **标准：** 保持你项目的质量标准

**持续改进**
- **更新 CLAUDE.md：** 随着你的项目发展
- **完善工作流程：** 基于最有效的方法
- **学习模式：** 从我和经验中学习